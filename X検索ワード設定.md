# シールトラッカー - X検索ワード設定ガイド

## 現在のX検索ワード設定

シールトラッカーは、以下の検索キーワードを使用してX（旧Twitter）から最新のシール情報を取得しています。

### 基本検索キーワード（全国共通）

以下の**9つの基本キーワード**で全国の情報を検索します：

1. **ボンボンドロップシール 入荷**
2. **ボンボンドロップシール 販売**
3. **シール 販売**
4. **シール 予約**
5. **シール 入荷**
6. **サンリオ シール 販売**
7. **たまごっち シール**
8. **ディズニー ボンボンドロップ**
9. **シール 入荷情報**

### 地域別検索キーワード（自動追加）

地域を選択すると、その地域の主要都市で自動的に検索します。

**検索対象：**
1. **投稿内容**での検索
2. **アカウント名**での検索（店舗名など）
3. **有名店舗名**での検索

#### 近畿を選択した場合の追加キーワード例：

**1. 投稿内容での検索：**
- シール 入荷 大阪
- シール 入荷 梅田
- シール 入荷 難波
- シール 販売 大阪
- シール 販売 梅田
- ボンボンドロップシール 大阪
- ボンボンドロップシール 梅田

**2. アカウント名での検索（店舗を発見）：**
- 大阪店 シール
- 梅田店 シール
- 難波ショップ シール
- 京都ストア シール
- 神戸SHOP シール
- 三宮店 シール販売

**3. 有名店舗名での検索：**
- 大阪 キディランド シール
- 梅田 ロフト シール
- 難波 ハンズ シール
- 京都 ドンキホーテ シール
- 神戸 ヴィレッジヴァンガード シール
- 三宮 アニメイト シール

#### 検索例：

**以下のようなアカウント名と投稿がヒットします：**

✅ **アカウント名：** @大阪梅田店キディランド  
   **投稿内容：** シール販売！  
   **検索ワード：** 「梅田店 シール」でヒット

✅ **アカウント名：** @難波ロフト公式  
   **投稿内容：** ボンボンドロップシール入荷しました  
   **検索ワード：** 「難波 ロフト シール」でヒット

✅ **アカウント名：** @京都SHOP_toys  
   **投稿内容：** サンリオシール予約受付中  
   **検索ワード：** 「京都SHOP シール」でヒット

### 各地域の検索対象都市一覧

| 地域 | 検索対象都市 |
|------|-------------|
| 北海道 | 札幌、函館、旭川 |
| 東北 | 青森、仙台、盛岡、秋田、山形、福島 |
| 関東 | 東京、渋谷、新宿、池袋、横浜、川崎、大宮、千葉、柏 |
| 中部 | 名古屋、静岡、浜松、新潟、金沢、長野 |
| **近畿** | **大阪、梅田、難波、京都、神戸、三宮、奈良、和歌山** |
| 中国 | 広島、岡山、山口、鳥取、島根 |
| 四国 | 高松、松山、徳島、高知 |
| 九州・沖縄 | 福岡、天神、博多、熊本、長崎、鹿児島、那覇 |

### 検索キーワード数の計算例

**近畿を選択した場合：**
- 基本キーワード：9個
- 地域別キーワード：
  - 投稿内容検索：8都市 × 3種類 = 24個
  - アカウント名検索：8都市 × 5種類 = 40個
  - 店舗名検索：8都市 × 6店舗 = 48個
- **合計：約121個のキーワードで徹底検索！**

**全国を選択した場合：**
- 基本キーワード：9個のみ
- 地域別キーワード：なし
- **合計：9個のキーワードで検索**

### 検索対象店舗リスト

地域別検索では、以下の有名店舗も自動的に検索対象になります：

1. **キディランド** - 玩具・キャラクターグッズ専門店
2. **ロフト** - 雑貨・文具店
3. **ハンズ** - 生活雑貨店
4. **ドンキホーテ** - ディスカウントストア
5. **ヴィレッジヴァンガード** - 書籍・雑貨店
6. **アニメイト** - アニメグッズ専門店

## 検索の仕組み

### データ取得方法

1. **Yahoo!リアルタイム検索**を使用
   - リアルタイムのX投稿を検索
   - 最新の投稿から情報を取得

2. **Google検索**を補助的に使用
   - Yahoo!で取得できない情報を補完
   - より広範囲な検索結果を取得

### 情報フィルタリング

- 各キーワードで検索した結果を統合
- 重複した投稿URLは自動的に削除
- 投稿日時の新しい順に並べ替え

## 地域フィルタリング

### 全国共通情報

以下のキーワードを含む投稿は、地域設定に関係なく常に表示されます：

- 全店
- 全国
- 公式
- オンライン
- 通販
- ネット
- Amazon
- 楽天
- Yahoo
- メルカリ

**表示例：**
- 「ロフト全店で入荷！」
- 「サンリオ公式オンラインストア」
- 「Amazon予約開始」

### 地域限定情報

地域を選択すると、その地域に関連する投稿のみが表示されます：

| 地域選択 | 表示される投稿 |
|---------|---------------|
| 全国 | すべての投稿 |
| 北海道 | 北海道の店舗情報 |
| 東北 | 青森、岩手、宮城、秋田、山形、福島 |
| 関東 | 東京、神奈川、埼玉、千葉、茨城、栃木、群馬 |
| 中部 | 新潟、富山、石川、福井、山梨、長野、岐阜、静岡、愛知 |
| **近畿** | **大阪、京都、兵庫、滋賀、奈良、和歌山、三重** |
| 中国 | 鳥取、島根、岡山、広島、山口 |
| 四国 | 徳島、香川、愛媛、高知 |
| 九州・沖縄 | 福岡、佐賀、長崎、熊本、大分、宮崎、鹿児島、沖縄 |

**例（近畿を選択した場合）：**
- ✅ 「梅田ロフトで入荷！」→ 表示（大阪府）
- ✅ 「京都駅前で販売中」→ 表示（京都府）
- ✅ 「サンリオ公式オンライン」→ 表示（全国共通）
- ❌ 「新宿店で入荷」→ 非表示（東京都）

## 使い方

### 最新情報を取得する

1. **SNSタブ**を開く
2. 右上の **🔄（更新）ボタン**をタップ
3. 最新のX投稿が自動取得されます
4. 「○件の最新投稿を取得しました」と表示されます

### 現在地を設定する

1. **SNSタブ**を開く
2. 右上の **📍（現在地）ボタン**をタップ
3. 地域を選択（例：近畿）
4. 設定は**自動保存**され、次回も引き継がれます

### 投稿を見る

1. 投稿カードをタップ
2. 実際のX投稿ページへ移動
3. **戻るボタン**でアプリへ戻れます

### 技術仕様

### ファイル構成

```
lib/services/realtime_sns_service.dart
```

このファイルで検索ワードやデータ取得ロジックが管理されています。

### 基本検索ワードのカスタマイズ

基本検索キーワードは以下の場所で変更できます：

```dart
// lib/services/realtime_sns_service.dart
final baseKeywords = [
  'ボンボンドロップシール 入荷',
  'ボンボンドロップシール 販売',
  'シール 販売',
  'シール 予約',
  'シール 入荷',
  'サンリオ シール 販売',
  'たまごっち シール',
  'ディズニー ボンボンドロップ',
  'シール 入荷情報',
];
```

### 地域別検索ワードの自動生成

地域が選択されると、以下のロジックで自動的に地域別キーワードを生成します：

```dart
// 地域ごとの都市リスト
final regionCities = {
  '近畿': ['大阪', '梅田', '難波', '京都', '神戸', '三宮', '奈良', '和歌山'],
  // 他の地域も同様...
};

// 1. 投稿内容での検索パターン
final contentTerms = ['シール 入荷', 'シール 販売', 'ボンボンドロップシール'];
// 例：「シール 入荷 大阪」

// 2. アカウント名での検索パターン
final accountTerms = ['店', 'ショップ', 'ストア', 'SHOP'];
// 例：「大阪店 シール」「梅田ショップ シール」

// 3. 有名店舗名での検索パターン
final storeNames = ['キディランド', 'ロフト', 'ハンズ', 'ドンキホーテ', 'ヴィレッジヴァンガード', 'アニメイト'];
// 例：「大阪 キディランド シール」
```

**検索キーワード生成例（大阪の場合）：**
```
投稿内容検索：
- シール 入荷 大阪
- シール 販売 大阪
- ボンボンドロップシール 大阪

アカウント名検索：
- 大阪店 シール
- 大阪ショップ シール
- 大阪ストア シール
- 大阪SHOP シール
- 大阪 シール 販売

店舗名検索：
- 大阪 キディランド シール
- 大阪 ロフト シール
- 大阪 ハンズ シール
- 大阪 ドンキホーテ シール
- 大阪 ヴィレッジヴァンガード シール
- 大阪 アニメイト シール
```

## よくある質問

### Q: 地域別検索はどのように動作しますか？

A: 
- **全国を選択**：基本キーワード9個で全国の情報を検索
- **地域を選択**（例：近畿）：基本9個 + 地域別約24個 = 合計33個のキーワードで検索
- 地域別キーワードは自動生成されるため、設定不要

### Q: 検索結果が少ない場合は？

A: 以下の対策があります：
- 更新ボタンで再取得
- 地域設定を「全国」に変更してより広範囲に検索
- 時間を置いてから再試行（投稿が増える時間帯を狙う）

### Q: 地域を変更すると検索結果はどうなりますか？

A: 
- 地域変更時に自動的に再検索が実行されます
- 選択地域に合わせたキーワードで最新情報を取得
- 全国共通情報は地域に関係なく表示

### Q: どのくらいの頻度で更新すればいいですか？

A: 
- **高頻度更新**：新商品発売日や人気商品の入荷時期
- **通常更新**：1日1〜2回程度
- **自動更新**：現在は手動更新のみ（将来的に自動更新機能を検討）

### Q: リアルタイム検索が失敗した場合は？

A: サンプルデータ（実際のX投稿URL）が自動的に表示されます。
すべて実在する投稿へのリンクなので、安心してご利用ください。

### Q: 地域設定はいつまで保存される？

A: アプリをアンインストールするまで永続的に保存されます。
他のページへ移動しても、設定はリセットされません。

## 更新履歴

- **2025-01-XX（v2.1）**: アカウント名検索機能を追加
  - 店舗アカウント名での検索を実装（「大阪梅田店キディランド」など）
  - 有名店舗名での地域別検索を追加（キディランド、ロフトなど6店舗）
  - 近畿選択時のキーワード数：33個 → **121個**に大幅強化
  - アカウント名と投稿内容の両方を検索対象に
  
- **2025-01-XX（v2.0）**: 地域別検索機能を大幅強化
  - 基本検索キーワードを5個→9個に拡張
  - 地域別キーワード自動生成機能を追加
  - 各地域の主要都市で自動検索（近畿：8都市、関東：9都市など）
  - 地域変更時の自動再検索機能を実装

- **2025-01-XX（v1.0）**: 初版作成
  - 5つの検索キーワード設定
  - 地域フィルタリング機能実装
  - 全国共通情報の自動判定機能追加

---

## 検索ワード設計の考え方

### 基本キーワード設計
- **商品名 + 入荷/販売**：具体的な商品の流通情報を取得
- **一般名詞 + 入荷/販売/予約**：広範囲な情報を網羅
- **キャラクター名 + シール**：特定ジャンルの情報を取得

### 地域別キーワード設計（3つのアプローチ）

**1. 投稿内容での検索**
- パターン：「シール 入荷 大阪」
- 目的：投稿本文に地域名が含まれる情報を取得

**2. アカウント名での検索**
- パターン：「大阪店 シール」「梅田ショップ シール」
- 目的：店舗アカウントからの投稿を発見
- 例：@大阪梅田店キディランド が「シール販売！」と投稿

**3. 有名店舗名での検索**
- パターン：「大阪 キディランド シール」
- 対象店舗：キディランド、ロフト、ハンズ、ドンキホーテ、ヴィレッジヴァンガード、アニメイト
- 目的：特定店舗チェーンの地域別情報を効率的に収集

---

**開発者向けメモ：**
- 検索キーワードは `RealtimeSnsService` で管理
- 地域別キーワードは `_getRegionalKeywords()` で自動生成
- 地域キーワードも `LocationSettingsService` で管理
- 外部リンクは `LaunchMode.externalApplication` と `webOnlyWindowName: '_blank'` を使用
- 検索API：Yahoo!リアルタイム検索（メイン）+ Google検索（補助）
